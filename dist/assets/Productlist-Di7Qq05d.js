import{u as k,r as o,j as t,S as N}from"./index-B1Lz2HTr.js";import{c as b}from"./cartService-CBG5IxyE.js";const d="http://localhost:3000/api/products",I={async getAll(){const a=await fetch(d);if(!a.ok)throw new Error("Không thể lấy danh sách sản phẩm");return a.json()},async getById(a){const r=await fetch(`${d}/${a}`);if(!r.ok)throw new Error("Không thể lấy sản phẩm");return r.json()},async create(a){const r=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error("Thêm sản phẩm thất bại");return r.json()},async update(a,r){const l=await fetch(`${d}/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok)throw new Error("Cập nhật sản phẩm thất bại");return l.json()},async remove(a){const r=await fetch(`${d}/${a}`,{method:"DELETE"});if(!r.ok)throw new Error("Xóa sản phẩm thất bại");return r.json()}},S=["Rau củ","Trái cây","Thịt & Trứng","Gạo","Nông sản khác"],L=["Tất cả",...S];function A(){try{const a=localStorage.getItem("user");if(a){const r=JSON.parse(a);return Number(r.id)}}catch{}return null}const K=()=>{const{searchTerm:a}=k(),r=A(),[l,w]=o.useState([]),[v,u]=o.useState(!0),[j,C]=o.useState(""),[m,T]=o.useState("Tất cả"),[c,h]=o.useState(1),g=12,[y,i]=o.useState("");o.useEffect(()=>{u(!0),I.getAll().then(e=>{const n=e.map(s=>({id:s.id,name:s.name,price:typeof s.price=="string"?Number(s.price):s.price,unit:s.unit??"sp",image:s.image_url||"/img/default.jpg",category:s.category||"",description:s.description||"",quantity:s.quantity??0,image_url:s.image_url||"",status:s.status??"",created_at:s.created_at??"",updated_at:s.updated_at??"",seller_id:s.seller_id??0,category_id:s.category_id??0}));w(n),u(!1)}).catch(()=>{C("Không thể tải sản phẩm"),u(!1)})},[]);const f=l.filter(e=>{const n=(e.name||"").toLowerCase().includes(a.toLowerCase()),s=m==="Tất cả"||e.category_id&&S[e.category_id-1]===m;return n&&s}),p=Math.ceil(f.length/g),x=f.slice((c-1)*g,c*g);async function _(e){if(!r){i("Bạn cần đăng nhập để thêm vào giỏ hàng"),setTimeout(()=>i(""),1200);return}try{await b.addItem(r,{product_id:e.id,quantity:1});const n=await b.getCart(r);localStorage.setItem("cart",JSON.stringify(n||[])),i("Đã thêm vào giỏ hàng")}catch(n){i("Thêm vào giỏ hàng thất bại"),console.error("Add to cart error:",n)}setTimeout(()=>i(""),1200)}const E=({product:e})=>t.jsxs("div",{className:"product-card",children:[t.jsx("div",{className:"product-image-container",children:t.jsx("img",{src:e.image_url||"/img/default.jpg",alt:e.name||"Sản phẩm",className:"product-image"})}),t.jsxs("div",{className:"product-info",children:[t.jsx("h3",{className:"product-name",children:e.name||"Không tên"}),t.jsxs("p",{className:"product-price",children:[(e.price!==void 0?e.price:0).toLocaleString("vi-VN"),"đ ",t.jsxs("span",{className:"unit",children:["/ ",e.unit?e.unit:"sp"]})]}),t.jsxs("button",{className:"btn-add-cart",onClick:()=>_(e),children:[t.jsx(N,{size:16})," Thêm vào giỏ"]})]})]}),P=()=>p<=1?null:t.jsxs("div",{className:"pagination",children:[t.jsx("button",{disabled:c===1,onClick:()=>h(c-1),children:"<"}),[...Array(p)].map((e,n)=>t.jsx("button",{className:c===n+1?"active":"",onClick:()=>h(n+1),children:n+1},n+1)),t.jsx("button",{disabled:c===p,onClick:()=>h(c+1),children:">"})]});return t.jsxs("main",{className:"product-page-layout",children:[t.jsxs("aside",{className:"filter-sidebar",children:[t.jsx("h3",{className:"sidebar-title",children:"Danh mục sản phẩm"}),t.jsx("ul",{className:"sidebar-list",children:L.map(e=>t.jsx("li",{className:m===e?"active":"",children:t.jsx("button",{className:"sidebar-btn",onClick:()=>{T(e),h(1)},children:e})},e))})]}),t.jsxs("section",{className:"product-list-container",children:[v?t.jsx("div",{className:"loading-products",children:"Đang tải sản phẩm..."}):j?t.jsx("div",{className:"error-products",children:j}):x.length>0?t.jsx("div",{className:"product-grid",children:x.map(e=>t.jsx(E,{product:e},e.id))}):t.jsx("p",{className:"no-results",children:"Không tìm thấy sản phẩm nào phù hợp."}),P()]}),y&&t.jsxs("div",{className:"notify-bottom show",children:[t.jsx(N,{size:20})," ",y]})]})};export{K as default};
